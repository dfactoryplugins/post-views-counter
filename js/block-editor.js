const{Fragment:p,Component:r}=wp.element,{withSelect:d}=wp.data,{registerPlugin:w}=wp.plugins,{TextControl:l,Button:n,Popover:o}=wp.components,{PluginPostStatusInfo:m}=wp.editPost;class h extends r{constructor(){super(...arguments),this.state={postViews:pvcEditorArgs.postViews,isVisible:!1},this.handleClick=this.handleClick.bind(this),this.handleClickOutside=this.handleClickOutside.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleSetViews=this.handleSetViews.bind(this)}handleClick(t){t.target.classList.contains("edit-post-post-views-toggle-link")&&this.setState(s=>({isVisible:!s.isVisible}))}handleClickOutside(t){t.target.classList.contains("edit-post-post-views-toggle-link")||this.setState(s=>({isVisible:!s.isVisible}))}handleCancel(t){this.setState(s=>({postViews:pvcEditorArgs.postViews,isVisible:!s.isVisible}))}handleSetViews(t){wp.data.dispatch("core/editor").editPost({meta:{_pvc_post_views:t}}),this.setState(()=>({postViews:t}))}static getDerivedStateFromProps(t,s){(t.isPublishing||t.isSaving)&&!t.isAutoSaving&&wp.apiRequest({path:`/post-views-counter/update-post-views/?id=${t.postId}`,method:"POST",data:{post_views:s.postViews}}).then(i=>i,i=>i)}render(){return wp.element.createElement(v,{postViews:this.state.postViews,isVisible:this.state.isVisible,handleClick:this.handleClick,handleClickOutside:this.handleClickOutside,handleCancel:this.handleCancel,handleSetViews:this.handleSetViews})}}const v=e=>wp.element.createElement(p,null,wp.element.createElement(m,{className:"edit-post-post-views"},wp.element.createElement("div",{className:"editor-post-panel__row-label"},wp.element.createElement("span",null,pvcEditorArgs.textPostViews)),!pvcEditorArgs.canEdit&&wp.element.createElement("div",{className:"editor-post-panel__row-control"},wp.element.createElement("div",{className:"components-dropdown edit-post-post-views-popover-wrapper"},wp.element.createElement(n,{size:"compact",variant:"tertiary",disabled:!0,className:"components-button edit-post-post-views-toggle-link"},e.postViews))),pvcEditorArgs.canEdit&&wp.element.createElement("div",{className:"editor-post-panel__row-control"},wp.element.createElement("div",{className:"components-dropdown edit-post-post-views-popover-wrapper"},wp.element.createElement(n,{size:"compact",variant:"tertiary",className:"components-button edit-post-post-views-toggle-link",onClick:e.handleClick},e.postViews,e.isVisible&&(pvcEditorArgs.wpGreater53?wp.element.createElement(o,{position:"bottom right",className:"edit-post-post-views-popover",onFocusOutside:e.handleClickOutside},wp.element.createElement("legend",null,pvcEditorArgs.textPostViews),wp.element.createElement(l,{className:"edit-post-post-views-input",type:"number",key:"post_views",value:e.postViews,onChange:e.handleSetViews}),wp.element.createElement("p",{className:"description"},pvcEditorArgs.textHelp),wp.element.createElement(n,{isLink:!0,className:"edit-post-post-views-cancel-link",onClick:e.handleCancel},pvcEditorArgs.textCancel)):wp.element.createElement(o,{position:"bottom right",className:"edit-post-post-views-popover",onClickOutside:e.handleClickOutside},wp.element.createElement("legend",null,pvcEditorArgs.textPostViews),wp.element.createElement(l,{className:"edit-post-post-views-input",type:"number",key:"post_views",value:e.postViews,onChange:e.handleSetViews}),wp.element.createElement("p",{className:"description"},pvcEditorArgs.textHelp),wp.element.createElement(n,{isLink:!0,className:"edit-post-post-views-cancel-link",onClick:e.handleCancel},pvcEditorArgs.textCancel)))))))),u=d((e,{forceIsSaving:t})=>{const{getCurrentPostId:s,isSavingPost:i,isPublishingPost:a,isAutosavingPost:c}=e("core/editor");return{postId:s(),isSaving:t||i(),isAutoSaving:c(),isPublishing:a()}})(h);w("post-views-counter",{icon:"",render:u});
