document.addEventListener("DOMContentLoaded",function(){(PostViewsCounter={promise:null,args:{},init:function(t){this.args=t;let e={},a="pvc_visits"+(!1!==t.multisite?"_"+parseInt(t.multisite):"");"cookieless"===t.dataStorage&&this.isLocalStorageAvailable()?(e.storage_type="cookieless",e.storage_data=this.readStorageData(a),"countAuthor"in t&&!0===t.countAuthor&&(e.storage_data_author=this.readStorageData("pvc_visits_user"+(!1!==t.multisite?"_"+parseInt(t.multisite):"")))):(e.storage_type="cookies",e.storage_data=this.readCookieData(a),"countAuthor"in t&&!0===t.countAuthor&&(e.storage_data_author=this.readCookieData("pvc_visits_user"+(!1!==t.multisite?"_"+parseInt(t.multisite):"")))),"rest_api"===t.mode?this.promise=this.request(t.requestURL,e,"POST",{"Content-Type":"application/x-www-form-urlencoded; charset=utf-8","X-WP-Nonce":t.nonce},a):(e.action="pvc-check-post",e.pvc_nonce=t.nonce,e.id=t.postID,this.promise=this.request(t.requestURL,e,"POST",{"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"},a))},request:function(t,e,a,o,i=""){let r={method:a,mode:"cors",cache:"no-cache",credentials:"same-origin",headers:o,body:this.prepareRequestData(e)},s=this;return fetch(t,r).then(function(t){if(!t.ok)throw Error(t.statusText);return t.json()}).then(function(t){try{"object"==typeof t&&null!==t&&("cookieless"===s.args.dataStorage?s.saveStorageData.call(s,i,t.storage,t.type):s.saveCookieData(i,t.storage),s.triggerEvent("pvcCheckPost",t))}catch(e){console.log("Invalid JSON data"),console.log(e)}}).catch(function(t){console.log("Invalid response"),console.log(t)})},prepareRequestData:function(t){return Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&").replace(/%20/g,"+")},triggerEvent:function(t,e){let a=new CustomEvent(t,{bubbles:!0,detail:e});document.dispatchEvent(a)},saveStorageData:function(t,e,a){"countAuthor"in this.args&&!0===this.args.countAuthor&&"user"in e&&window.localStorage.setItem("pvc_visits_user"+(!1!==this.args.multisite?"_"+parseInt(this.args.multisite):""),JSON.stringify(e.user)),window.localStorage.setItem(t,JSON.stringify(e[a]))},readStorageData:function(t){let e=null;return null===(e=window.localStorage.getItem(t))&&(e=""),e},saveCookieData:function(t,e){var a="";"https:"===document.location.protocol&&(a=";secure");for(let o=0;o<e.name.length;o++){var i=new Date,r=parseInt(e.expiry[o]);r?r*=1e3:r=i.getTime()+864e5,i.setTime(r),document.cookie=e.name[o]+"="+e.value[o]+";expires="+i.toUTCString()+";path=/"+("/"===this.args.path?"":this.args.path)+";domain="+this.args.domain+a+";SameSite=Lax"}},readCookieData:function(t){var e=[];return document.cookie.split(";").forEach(function(a){var[o,i]=a.split("="),r=o.trim();RegExp(t+"\\[\\d+\\]").test(r)&&e.push(i)}),e.join("a")},isLocalStorageAvailable:function(){var t;try{return(t=window.localStorage).setItem("__pvcStorageTest",0),t.removeItem("__pvcStorageTest"),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&t&&0!==t.length}}}).init(pvcArgsFrontend)});