(function(t){if(typeof t>"u")return;let i=null,l=null;if(typeof pvcColumnModal>"u")return;function u(){return typeof MicroModal>"u"?!1:(MicroModal.init({disableScroll:!0,awaitCloseAnimation:!0}),!0)}function p(e,o){if(!e)return!1;l=e,t("#pvc-modal-title").text(o);const n=t(".pvc-modal-chart-container");return n.addClass("loading"),n.find(".spinner").addClass("is-active"),t(".pvc-modal-views-label").text(""),t(".pvc-modal-count").text(""),t(".pvc-modal-dates").html(""),!0}function v(){t("#pvc-modal-title").text(""),t(".pvc-modal-views-label").text(""),t(".pvc-modal-count").text(""),t(".pvc-modal-dates").html("");const e=t(".pvc-modal-chart-container");e.removeClass("loading"),e.find(".spinner").removeClass("is-active"),t(".pvc-modal-error").remove()}function c(e,o){const n=t(".pvc-modal-chart-container");n.addClass("loading"),n.find(".spinner").addClass("is-active"),t.ajax({url:pvcColumnModal.ajaxURL,type:"POST",dataType:"json",data:{action:"pvc_column_chart",nonce:pvcColumnModal.nonce,post_id:e,period:o},success:function(a){a.success?m(a.data):s(a.data.message||pvcColumnModal.i18n.error)},error:function(a,r,d){s(pvcColumnModal.i18n.error)},complete:function(){n.removeClass("loading"),n.find(".spinner").removeClass("is-active")}})}function m(e){const o=document.getElementById("pvc-modal-chart");if(!o)return;i&&(i.destroy(),i=null),t(".pvc-modal-error").remove(),t(o).show(),t(".pvc-modal-views-label").text(pvcColumnModal.i18n.summary),t(".pvc-modal-count").text(e.total_views.toLocaleString()),t(".pvc-modal-dates").html(e.dates_html);const n={type:"line",data:e.data,options:{maintainAspectRatio:!1,responsive:!0,plugins:{legend:{display:!1},tooltip:{callbacks:{title:function(a){return e.data.dates[a[0].dataIndex]},label:function(a){const r=a.parsed.y,d=r===1?pvcColumnModal.i18n.view:pvcColumnModal.i18n.views;return r.toLocaleString()+" "+d}}}},scales:{x:{display:!0,grid:{display:!1}},y:{display:!0,beginAtZero:!0,ticks:{precision:0},grid:{color:"rgba(0, 0, 0, 0.05)"}}}}};e.design&&n.data.datasets.forEach(function(a){Object.assign(a,e.design),a.tension=.4}),i=new Chart(o.getContext("2d"),n)}function s(e){i&&(i.destroy(),i=null),t(".pvc-modal-summary").text(""),t(".pvc-modal-dates").html("");const o=t(".pvc-modal-chart-container");o.removeClass("loading"),o.find(".spinner").removeClass("is-active"),t(".pvc-modal-error").remove(),o.before('<p class="pvc-modal-error">'+e+"</p>"),o.find("canvas").hide()}t(function(){t("#pvc-chart-modal").length!==0&&u()&&(t(document).on("click",".pvc-view-chart",function(e){e.preventDefault();const o=t(this).data("post-id"),n=t(this).data("post-title");o&&p(o,n)&&typeof MicroModal<"u"&&MicroModal.show("pvc-chart-modal",{onShow:function(a){l&&c(l,"")},onClose:function(){i&&(i.destroy(),i=null),l=null,v()},disableScroll:!0,awaitCloseAnimation:!0})}),t(document).on("click",".pvc-modal-nav-prev, .pvc-modal-nav-next",function(e){if(e.preventDefault(),t(this).hasClass("pvc-disabled"))return;const o=t(this).data("period");o&&l&&c(l,o)}))})})(jQuery);
